@using Microsoft.AspNetCore.Identity;
@using Turnero.Utilities.Utilities;
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
<!DOCTYPE html>
<html lang="es-ar">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>@ViewData["Title"] - Turnero</title>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.23.0/sweetalert2.min.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/light.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
        <link rel="stylesheet" href="~/css/site.css" />
        <link rel="stylesheet" href="~/css/Login.css" />
        <link rel="stylesheet" href="~/css/table.css" />
        <link rel="manifest" href="/manifest.json">
        <script>
            // Verificar si el navegador es compatible con service worker
              if ('serviceWorker' in navigator) {
                  window.addEventListener('load', function () {
                      navigator.serviceWorker.register('/service-worker.js').then(function (registration) {
                          console.log('Service Worker registrado con éxito:', registration);
                      }).catch(function (error) {
                          console.log('Error al registrar el Service Worker:', error);
                      });
                  });
              }
        </script>
        @RenderSection("header", required: false)
    </head>
    <body>

        @{
            if (SignInManager.IsSignedIn(User))
            {

                <nav class="navbar navbar-expand-lg bg-light">
                    <div class="container-fluid">
                        <img title="Logo" class="navbar-brand img-thumbnail img-fluid" width="40" height="40" src="~/favicon.ico" />

                        <button class="navbar-toggler"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#navbarNavAltMarkup"
                                aria-controls="#navbarNavAltMarkup"
                                aria-expanded="false"
                                aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>

                        <div class="navbar-collapse collapse" id="navbarNavAltMarkup" style="">
                            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                @if ((User.IsInRole(RolesConstants.Ingreso) || User.IsInRole(RolesConstants.Medico)))
                                {
                                    <li class="nav-item">
                                        <a class="nav-link text-dark" asp-area="" asp-controller="Turns" asp-action="Index">Turnos</a>
                                        
                                    </li>
                                    @if (User.IsInRole(RolesConstants.Medico))
                                    {
                                        <li class="nav-item">
                                            <a class="nav-link text-dark" asp-area="" asp-controller="Patients" asp-action="Index">Pacientes</a>
                                        </li>
                                    }
                                }
                                else if (User.IsInRole(RolesConstants.Admin))
                                {
                                    <li class="nav-item dropdown">
                                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Administrar</a>
                                        <ul class="dropdown-menu">
                                            <li><a asp-action="ListUsers" asp-controller="Administration" class="dropdown-item">Users</a></li>
                                            <li><a asp-action="ListRoles" asp-controller="Administration" class="dropdown-item">Roles</a></li>
                                            <li><a asp-action="Index" asp-controller="Medics" class="dropdown-item">Medicos</a></li>
                                            <li><a asp-action="Index" asp-controller="TimeTurn" class="dropdown-item">Horarios</a></li>
                                        </ul>
                                    </li>
                                }
                            </ul>
                            <partial name="_LoginPartial" />

                        </div>
                    </div>
                </nav>
            }
        }
        <div class="container-fluid">
            <main role="main" class="pb-3 row">
                @RenderBody()
            </main>
        </div>

        <div class="modal fade" id="GlobalModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="GlobalModal-title"></h5>
                        <button type="button" class="btn-close" data-close-modal aria-label="Close"></button>
                    </div>

                    <div class="modal-body" id="GlobalModal-body">
                    </div>
                </div>
            </div>
        </div>

        <script src="~/js/modalUtils.js" asp-append-version="true"></script>
        <script src="~/js/common.js" asp-append-version="true"></script>
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.23.0/sweetalert2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.3.0-beta.18/pdfmake.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.3.0-beta.18/fonts/Roboto.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/js/all.min.js" ></script>
        <script src="~/js/site.js" asp-append-version="true"></script>
    
        @RenderSection("Scripts", required: false)
    </body>
</html>